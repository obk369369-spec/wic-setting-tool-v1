<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WIC 세팅 도구 v1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;}
    body{margin:0;padding:16px;background:#f3f4f6;color:#111827;}
    h1{margin:0 0 8px;font-size:20px;}
    .subtitle{font-size:12px;color:#4b5563;margin-bottom:12px;}
    .layout{max-width:1100px;margin:0 auto;}
    .panel{background:white;border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,0.08);}
    label{font-size:12px;color:#4b5563;display:block;margin-bottom:4px;}
    textarea,input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid #d1d5db;font-size:13px;resize:vertical;}
    textarea:focus,input[type="text"]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 1px #2563eb22;}
    .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
    .row>div{flex:1 1 200px;}
    button{border-radius:999px;border:none;padding:6px 12px;font-size:12px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;white-space:nowrap;}
    button:disabled{opacity:0.4;cursor:default;}
    .btn-primary{background:#2563eb;color:white;}
    .btn-secondary{background:#e5e7eb;color:#111827;}
    .btn-github{background:#0f172a;color:white;}
    .btn-deno{background:#059669;color:white;}
    .btn-core{background:#f59e0b;color:white;}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px;}
    .card{background:white;border-radius:12px;padding:10px;border:1px solid #e5e7eb;display:flex;flex-direction:column;gap:6px;}
    .card-header{display:flex;justify-content:space-between;align-items:center;gap:6px;}
    .card-title{font-size:13px;font-weight:600;}
    .card-tag{padding:2px 6px;border-radius:999px;font-size:10px;background:#e5e7eb;color:#374151;}
    .card-body{font-size:12px;color:#4b5563;white-space:pre-line;}
    .status-row{display:flex;align-items:center;gap:6px;font-size:11px;}
    .status-dot{width:8px;height:8px;border-radius:999px;background:#9ca3af;}
    .status-ok{background:#10b981;}
    .status-error{background:#ef4444;}
    .status-testing{background:#fbbf24;}
    .small-label{font-size:11px;color:#6b7280;}
    .url-row{display:flex;gap:4px;margin-top:4px;}
    .url-row input[type="text"]{flex:1;font-size:11px;padding:5px 6px;}
    .url-row button{font-size:11px;padding:4px 8px;}
    .log-box{background:#f9fafb;border-radius:6px;padding:6px;font-size:11px;color:#4b5563;max-height:80px;overflow-y:auto;border:1px dashed #e5e7eb;}
    .action-row{display:flex;justify-content:center;gap:6px;margin-top:4px;flex-wrap:wrap;}
    .meta-row{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#6b7280;margin-top:4px;}
    .badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;padding:2px 6px;border-radius:999px;background:#e5e7eb;}
  </style>
</head>
<body>
<div class="layout">
  <h1>WIC 세팅 도구 v1</h1>
  <div class="subtitle">도구 이름/목적 입력 → 카드 생성 → 주소 관리 → 자동 테스트까지 한 화면에서 관리합니다.</div>

  <div class="panel">
    <label>도구 목록 입력 (각 줄: 도구 이름 / 목적)</label>
    <textarea id="toolsInput" rows="6"></textarea>

    <div class="row">
      <div>
        <label>GitHub 기본 주소</label>
        <input id="githubBase" type="text" placeholder="https://github.com/..." />
      </div>
      <div>
        <label>Deno 기본 주소</label>
        <input id="denoBase" type="text" placeholder="https://dash.deno.com/projects/..." />
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="generateBtn" class="btn-primary">카드 생성</button>
    </div>
  </div>

  <div class="panel">
    <div class="meta-row">
      <span class="badge"><span class="status-dot status-testing"></span>자동 테스트 상태</span>
      <span id="autoTestInfo">자동 테스트 대기 중</span>
    </div>
  </div>

  <div class="cards" id="cardsContainer"></div>
</div>

<script>
const toolsInput=document.getElementById("toolsInput");
const githubBaseInput=document.getElementById("githubBase");
const denoBaseInput=document.getElementById("denoBase");
const cardsContainer=document.getElementById("cardsContainer");
const autoTestInfo=document.getElementById("autoTestInfo");
let autoTestTimer=null;

function parseTools(text){
  return text.split("\n").map((l,i)=>{
    const s=l.split("/");
    if(!s[0].trim()) return null;
    return {id:i+1,name:s[0].trim(),purpose:s.slice(1).join("/").trim()};
  }).filter(Boolean);
}

function log(box,msg){
  const t=new Date();const hh=String(t.getHours()).padStart(2,"0");const mm=String(t.getMinutes()).padStart(2,"0");
  box.textContent+=(box.textContent.trim()?`\n[${hh}:${mm}] ${msg}`:`[${hh}:${mm}] ${msg}`);
  box.scrollTop=box.scrollHeight;
}

function setStatus(dot,text,status){
  dot.classList.remove("status-ok","status-error","status-testing");
  if(status==="ok"){dot.classList.add("status-ok");text.textContent="상태: 정상";}
  else if(status==="error"){dot.classList.add("status-error");text.textContent="상태: 오류";}
  else if(status==="testing"){dot.classList.add("status-testing");text.textContent="상태: 테스트 중";}
  else{text.textContent="상태: 대기";}
}

function manualTest(card){
  const dot=card._dot, text=card._text, logBox=card._log;
  const g=card._git.value.trim(), d=card._deno.value.trim();
  setStatus(dot,text,"testing");log(logBox,"수동 테스트 시작");

  setTimeout(()=>{
    if(!g && !d){setStatus(dot,text,"error");log(logBox,"주소 없음 → 오류");}
    else{setStatus(dot,text,"ok");log(logBox,"기본 체크 통과");}
  },500);
}

function createCard(t,gBase,dBase){
  const c=document.createElement("div");c.className="card";

  const h=document.createElement("div");h.className="card-header";
  const title=document.createElement("div");title.className="card-title";title.textContent=t.name;
  const tag=document.createElement("div");tag.className="card-tag";tag.textContent=`도구 #${t.id}`;
  h.append(title,tag);

  const body=document.createElement("div");body.className="card-body";body.textContent=t.purpose||"";
  const srow=document.createElement("div");srow.className="status-row";
  const dot=document.createElement("span");dot.className="status-dot";const stext=document.createElement("span");stext.className="small-label";stext.textContent="상태: 대기";
  srow.append(dot,stext);

  const gl=document.createElement("div");gl.className="small-label";gl.textContent="GitHub 업로드 주소";
  const grow=document.createElement("div");grow.className="url-row";
  const gin=document.createElement("input");gin.type="text";if(gBase)gin.value=gBase;
  const gbtn=document.createElement("button");gbtn.className="btn-github";gbtn.textContent="GitHub";gbtn.onclick=()=>gin.value.trim()&&window.open(gin.value,"_blank");
  grow.append(gin,gbtn);

  const dl=document.createElement("div");dl.className="small-label";dl.textContent="Deno 업로드 주소";
  const drow=document.createElement("div");drow.className="url-row";
  const din=document.createElement("input");din.type="text";if(dBase)din.value=dBase;
  const dbtn=document.createElement("button");dbtn.className="btn-deno";dbtn.textContent="Deno";dbtn.onclick=()=>din.value.trim()&&window.open(din.value,"_blank");
  drow.append(din,dbtn);

  const logBox=document.createElement("div");logBox.className="log-box";logBox.textContent="아직 테스트 기록이 없습니다.";

  const arow=document.createElement("div");arow.className="action-row";
  const tbtn=document.createElement("button");tbtn.className="btn-secondary";tbtn.textContent="테스트";tbtn.onclick=()=>manualTest(c);
  arow.append(tbtn);

  c._dot=dot;c._text=stext;c._log=logBox;c._git=gin;c._deno=din;

  c.append(h,body,srow,gl,grow,dl,drow,logBox,arow);
  return c;
}

function autoTest(){
  const cards=[...cardsContainer.children];
  if(!cards.length){autoTestInfo.textContent="카드 없음";return;}
  const t=new Date();const hh=String(t.getHours()).padStart(2,"0");const mm=String(t.getMinutes()).padStart(2,"0");
  autoTestInfo.textContent=`자동 테스트 실행: ${hh}:${mm}`;

  cards.forEach(c=>{
    const dot=c._dot, text=c._text, logBox=c._log;
    const g=c._git.value.trim(), d=c._deno.value.trim();
    setStatus(dot,text,"testing");log(logBox,"자동 테스트 시작");

    setTimeout(()=>{
      if(!g && !d){setStatus(dot,text,"error");log(logBox,"주소 없음 → 오류 가능");}
      else{setStatus(dot,text,"ok");log(logBox,"자동 체크 통과");}
    },600);
  });
}

function startAutoLoop(){
  if(autoTestTimer)clearInterval(autoTestTimer);
  autoTest();autoTestTimer=setInterval(autoTest,600000);
}

document.getElementById("generateBtn").onclick=()=>{
  const tools=parseTools(toolsInput.value);
  cardsContainer.innerHTML="";
  if(!tools.length)return alert("도구 입력 없음");
  const gb=githubBaseInput.value.trim();
  const db=denoBaseInput.value.trim();
  tools.forEach(t=>cardsContainer.append(createCard(t,gb,db)));
  startAutoLoop();
};
</script>
</body>
</html>
